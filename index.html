<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Lab 3: Sign Up</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
	<h1> Sign Up </h1>
	<form id="signupForm" method="GET" action="welcome.html">
		First Name : <input type="text" name="fName"> <br>
		Last Name : <input type="text" name="lName"> <br>
		Gender : <input type="radio" name="gender" value="m">Male
				 <input type="radio" name="gender" value="f"> Female <br><br>
		Zip Code : <input type="text" name="zip" id="zip"><br>
		City : <span id="city"></span> <br>
		Latitutde : <span id="latitude"></span> <br>
		Longitude : <span id="longitude"></span> <br><br>
		State : 
		<select id="state" name="state">
			<option value="">Select One</option>
			<option value="ca"> California </option>
			<option value="ny"> New york </option>
			<option value="tx"> Texas </option>
		</select><br/>

		Select a County : <select id="county"></select><br><br>

		Desired Username : <input type="text" id="username" name="username"> <span id="usernameError"></span><br>
		Password : <input type="password" id="password" name="password"><br>
		Password again : <input type="password" id="passwordAgain"><span id="passwordAgainError"></span><br>


		<input type="submit" value="Sign Up!">
	</form>
		<script>
			//Displaying City from API after typing a zip code
			$("#zip").on("change",function(){
				$.ajax({
					method: "GET",
					url: "https://cst336.herokuapp.com/projects/api/cityInfoAPI.php",
					dataType: "json",
					data: {"zip": $("#zip").val()},
					success: function(result, status){
							//alert(result.city);
							$("#city").html(result.city);
							$("#latitude").html(result.latitude);
							$("#longitude").html(result.longitude);
					}
				}); // ajax
			}); // zip

			$("#state").on("change", function () {
				$.ajax({
					method: "GET",
					url: "https://cst336.herokuapp.com/projects/api/countyListAPI.php",
					dataType: "json",
					data: {"state": $("#state").val()},
					success: function(result, status){
							//alert(result[0].county);
							$("#county").html("<option> Select One </option>");
							for (let i=0; i <result.length; i++){
								$("#county").append("<option>" + result[i].county + "</option>");
							}
					}
				}); // ajax
			})

			var usernameAvailable = false;

			$("#username").change(function(){
				$.ajax({
					method: "GET",
					url: "https://cst336.herokuapp.com/projects/api/usernamesAPI.php",
					dataType: "json",
					data: {"username": $("#username").val()},
					success: function (result, status){
						if(result.available){
							$("#usernameError").html("Username is available!");
							$("#usernameError").css("color", "green");
							usernameAvailable = true;
						}else {
							$("#usernameError").html("Username is unavailable!");
							$("#usernameError").css("color", "red");		
							usernameAvailable = false;					
						};
					};
				});
			});


				$("#signupForm").on("submit",function(e){
					//alert("Submitting form...");
					if(!isFormValid){
						e.preventDefault();
					};

				});

				function isFormValid() {
					isValid = true;
					if(!usernameAvailable){
						isValid = false;
					};

					if($("#username").val().length== 0){
						isValid = false;
						$("#usernameError").html("Username is required");
					};

					if($("#password").val() != $("#passwordAgain").val()){
						$("#passwordAgainError").html("Password Mismatch!");
						isValid = false;
					}
					return isValid;
				};

		</script>
</body>
</html>